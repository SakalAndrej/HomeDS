\chapter{HomeDS - Server}
\section{Einleitung}\label{sec:einleitung}
Im Rahmen der Diplomarbeit wird neben dem XIBO-Server ein weiterer Java Enterprise Edition Server eingesetzt. Aufgrund der hohen Komplexität des Signage-Servers jedoch relativ dünn dokumentierten API-Schnittstellen und begrenzten technischen Möglichkeiten, muss ein eigens programmierter Server eingesetzt werden. Dieser wird die Kommunikation vom Signage Server zur Android App erleichtern. 

GRAFIK KOMMUNIKATION
 
\section{Anforderungen an den HomeDS Server}\label{sec:homeds}
Der JavaEE Server soll die verschiedenen komplizierten Abläufe des XIBO-Servers vereinfachen. Die  Zugriffe mittels REST die eigentlich direkt auf den XIBO laufen sollen, werden über den JavaEE Server verwaltet. Das heißt der Java Enterprise Server empfängt REST Zugriffe verarbeitet diese entsprechen ab und tätigt somit REST Abfragen auf den XIBO Server. Dies hat insofern Vorteile, da die komplizierten und meist mit viel Aufwand verknüpften Authentifizierungen wegfallen. Somit können ohne Probleme neue Funktionen hinzugefügt und  an neue Anforderungen angepasst werden.
 
\section{Funktionen des HomeDS Server}\label{sec:homedsfunction}
Der JavaEE Server verfügt über eine eigene MySQL Datenbank. Diese wird gebraucht, um die ''DataSets'' aus dem Signage-Server zwischenzuspeichern. Diese DataSets sind enthalten einen Titel und eine Nachricht die dann später angezeigt werden. Dies ist erforderlich da die Nachrichten Datums gesteuert ein oder ausgeblendet werden müssen.
 
\section{DataSet mit Ablaufdatum}\label{sec:datasetexpiredate}
Eine der Funktionen des Servers ist das Hinzufügen, Ändern und Löschen vom DataSet. Da der Digital Signage Server über keine Felder wie Start- und Enddatum verfügen.

Die Logik ist simple. Der Benutzer kann Start- und Enddatum für jeden einzelnen DataSet eingeben. Erst wenn das Datum genau in diesem Zeitintervall inklusive den Grenzen liegt, wird das DataSet an den Xibo mittels API-Schnittstelle weitergegeben. 

\begin{lstlisting}[language=Java, caption={public void doCheckEvery24Hours()}]
if (dataset.isActive() == false && (dataset.getFromDate().minusDays(1)
        .isBefore(LocalDate.now()))) {
    try {
        //if succesfull added then set active true and add id
        if ((id=dataSetApi.addDataSetField(dataset)) > 0) {
            dataset.setDataRowId(id);
            dataset.setActive(true);
            dataSetFieldFacade.save(dataset);
        }
    } catch (NoConnectionException e) {
        // Catch Exception
    }
}
\end{lstlisting}

Die Überprüfung ob die DataSets aus der Server-Datenbank im Zeitintervall liegen, wird mittels eines ''TimeSchedule'' jeden Tag um 01:00 Uhr durchgeführt. Falls dieses DataSet im Intervall liegt, wird dieses DataSet an den XIBO Signage Server gesendet. Diese Überprüfung beinhaltet auch das FromDate. Dies löscht bei überschreiten des Bis-Datums das DataSet aus dem Digital Signage heraus. 

Die Überprüfung ob das Startdatum heute oder vor dem heutigem Datum liegt, wird mithilfe der Java Annotation @Schedule realisiert. (siehe Codeausschnitt) 

\section{Medien abspielen}\label{sec:playmedia}
Eine weitere wichtige Funktion ist das Abspielen der Medien die im XIBO hinterlegt sind. Es soll dem Nutzer eine einfache und übersichtliche Oberfläche zur Verfügung gestellt werden die Medien abspielen soll. Der Nutzer kann jedoch vorher den Bildschirm auswählen auf den diese Medien abgespielt werden sollen. Um jedoch zu verhindern das der Nutzer zwischen hunderten von Medien sein Video suchen muss gibt es eine Schlagwort Wolke.

Die Medien im XIBO sind mit einem Schlagwort versehen. Diese Schlagwörter können sein die jeweilige Abteilung also Informatik, Medientechnik oder Elektronik. Oder aber auch ob es sich um ein Projekt oder sonstiges. 

Mithilfe dieser Tags wollen wir dem Nutzer die Suche nach dem richtigen Video erleichtern. Der Nutzer bekommt die Möglichkeit einer dieser Tags auf der HomeDs Weboberfläche auszuwählen daraufhin werden nur die Videos mit dem entsprechendem Tag angezeigt.

\section{Jave Enterprise Edition mit Android über REST}\label{sec:javaeeandroidrest}
Ein weiterer essentieller Teil des Server auf Java Enterprise Edition Basis ist die Kommunikation mittels REST. Alle Funktionen des Servers werden mit REST für die Android Applikation zur Verfügung gestellt. 

\section{Swagger}\label{sec:javaeeandroidrestswagger}
Swagger wird verwendet um Funktionalität und Möglichkeit einer API übersichtlich zu gestalten. Um die REST Schnittstellen zu dokumentieren und übersichtlich zu visualisieren wird Swagger verwendet. Dabei gibt es zwei verschiedene Arten eine REST-Dokumentation zu erstellen. 

Die erste Möglichkeit wäre, mit dem Swagger Editor die Dokumentation in der JSON-Ausdruckssprache mit der Hand zu schreiben und immer wieder zu aktualisieren. Natürlich ist dies bei vielen verschiedenen GETs, POSTs, PUTs und DELETEs sehr aufwendig und mühsam.

Bei der zweiten Methode, die auch bei der Diplomarbeit zum Einsatz kommt, werden die API's automatisch von der im Projekt eingebundenen Swagger Engine erkannt. Daraus wird dann auch wieder eine JSON-File generiert, die dann mithilfe von Swagger-UI gut im Browser über eine Webseiten URL erreichbar ist.


Verweis: https://swagger.io/

\section{Java Server Faces mit JavaEE}\label{sec:javaeejsf}
Um den Benutzern die Möglichkeit zu geben die Funktionen unseres Servers zu nutzen wurde im Rahmen der Diplomarbeit auch eine Webapplikation erstellt. Und da JSF also Java Server Faces mit einem Java EE Server harmoniert haben wir  uns entschieden eine Webapplikation zu erstellen. Dies hat viele Vorteile wie z. Bsp. die Platformunabhängigkeit und auch die schnellere Entwicklung im Vergleich zu anderen Clients. 

Mit JSF wird nämlich über eine Managed Bean direkt im XHTML auf die Funktionen des Servers zugegriffen somit sind keine REST Zugriffe nötig. 

Unsere Weboberfläche ist Responsive gestaltet und mithilfe von Java Server Faces mit BootsFaces realisiert worden. Das Bootsfaces Framework stellt fertige Komponenten zur Verfügung wie Buttons, Listen, Forms etc. Dabei wurde Bootstrap als Vorbild hergenommen.

BILD VON OBERFLÄCHE

Die Aufgabe der DataSet Webapplikation ist DataSet zu ändern, hinzufügen oder zu löschen. Die Applikation besteht grob gesagt aus 2 Teilen. 

Teil 1 kümmert sich um das Anzeigen aller DataSets in einer Responisve Komponente die "DataTable" gennant wird in der Bibliothek vom Bootsfaces Framework. Im DataTable ist es möglich die Anzahl der angezeigten Elemente pro Seite zu begrenzen oder erweitern,  die einzelnen Spalten sortieren dabei ***ascending*** oder ***descending*** und durch die verschiedenen Spalten einer Zeile eine Suche durchzuführen. 

Es ist auch durch die editierbaren Textfelder und DatePicker möglich die DataSets zu ändern. Durch klicken auf den Speichern Button wird die Änderung des einzelnen DataSets bestätigt. Durch klicken auf den Löschen Button
Verweis auf JSF Section,

\section{HomeDS Server Projekt-Struktur}\label{sec:javaeestruktur}


\section{HomeDS Server Structure Crawler}\label{sec:javaeestructurecrawler}
Für das verstehen des Aufbaus eines Layouts war es die Aufgabe einen sogennanten StructureCrawler zu erstellen. Dieser soll den JSON Aufbau eines Layouts ausgeben. Durch diese Funktion ist es für uns möglich gewesen das ganze Signage System zu verstehen und zu verwenden. Der Crawler ist eigentlich nur ein REST-Zugriff der sich alle Layouts vom XIBO Server holt und dabei alle anderen Child-Elemente des Layouts mitschickt. Dies ist praktisch den es unterstützt uns bei dem Arbeiten mit vielen verschiedenen Ids die richtig sein müssen.

WEBOBERFLÄCHE VOM CRAWLER

\section{HomeDS Server Slideshow}\label{sec:homedsslideshow}
Eine weitere Funktion des HomeDs Servers ist das abspielen von Medien ohne diese in den XIBO hochladen zu müssen. Dies ist insofern wichtig da man bei großen Mengen von Daten nicht das XIBO zu müllen sollte. Dies wurde mittels JSF, Bootsfaces und JavaScript realisiert. Die Bilder werden von einem lokalen Ordner der Reihe nach abgespielt. Der Wechselintervall beträgt 3 Sekunden.

JavaScript	code erklären
